---
layout: default
title: Transit Map
permalink: project/mapbox/
---
<div> <h3><a href="/project"> Back to Dashboard </a></h3> </div>
<!-- Map Container -->
<div id="map" style="width: 100%; height: 500px;"></div>

<!-- Fixed Bottom Panel for Popups -->
<div id="sidebar" style="width: 100%; height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 15px; background-color: #f9f9f9; margin-top: 10px;">
    <h3>Feature Information</h3>
    <p style="color: #666;">Click on a feature to see details</p>
    <div id="feature-info"></div>
</div>


<link href='https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js'></script>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiamdvYmF0MTMiLCJhIjoiY21nMnVtcTh6MTQ4bDJrb2puczF6dWoyeCJ9.6hqHyL74X4bJhjYJXvo9WQ';

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/jgobat13/cmidr44cy007r01r985yx1icu', // Your style URL with layers
    center: [-122.3328 , 47.6061], // Adjust to your area
    zoom: 10
});

map.on('load', function() {
    var ROUTES_LAYER = 'TransitRoutes';
    var STOPS_LAYER = 'TransitStops';
    var POLYGONS_LAYER = 'CensusTracts';
    
    var featureInfo = document.getElementById('feature-info');
    
       // Single click handler for all layers
    map.on('click', function(event) {
        // Add buffer for easier clicking on points and lines
        var bbox = [
            [event.point.x - 30, event.point.y - 30],
            [event.point.x + 30, event.point.y + 30]
        ];
        
        // Query all three layers at once
        var features = map.queryRenderedFeatures(bbox, {
            layers: [STOPS_LAYER, ROUTES_LAYER, POLYGONS_LAYER]
        });
        
        if (!features.length) {
            return;
        }
        
        // Prioritize: Stops first, then Routes, then Polygons
        var feature = null;
        
        // Look for stops first
        for (var i = 0; i < features.length; i++) {
            if (features[i].layer.id === STOPS_LAYER) {
                feature = features[i];
                break;
            }
        }
        
        // If no stop found, look for routes
        if (!feature) {
            for (var i = 0; i < features.length; i++) {
                if (features[i].layer.id === ROUTES_LAYER) {
                    feature = features[i];
                    break;
                }
            }
        }
        
        // If no route found, use polygon
        if (!feature) {
            feature = features[0];
        }
        
        var props = feature.properties;
        var layerId = feature.layer.id;
        
        // Display based on layer type
        if (layerId === ROUTES_LAYER) {
            var routeHTML = '<div style="margin-top: 10px;">' +
                            '<h4 style="margin-top: 0; color: #2c5282;">Transit Route</h4>' +
                            '<strong>Agency:</strong> ' + (props.agency_name || 'N/A') + '<br>' +
                            '<strong>Route:</strong> ' + (props.route_long_name || 'N/A') + '<br>' +
                            '<strong>Route Desc:</strong> ' + (props.route_desc || 'N/A') + '<br>' +
                            '<strong>Route Line:</strong> ' + (props.route_short_name || 'N/A') + '<br>';
            
            if (props.route_url) {
                routeHTML += '<strong>URL:</strong> <a href="' + props.route_url + '" target="_blank">More Info</a><br>';
            }
            
            routeHTML += '</div>';
            featureInfo.innerHTML = routeHTML;
            
        } else if (layerId === STOPS_LAYER) {
            var stopHTML = '<div style="margin-top: 10px;">' +
                           '<h4 style="margin-top: 0; color: #2c5282;">Transit Stop</h4>' +
                           '<strong>Stop Name:</strong> ' + (props.stop_name || props.Stop_Name || 'N/A') + '<br>' +
                           '</div>';
            featureInfo.innerHTML = stopHTML;
            
        } else if (layerId === POLYGONS_LAYER) {
            var censusHTML = '<div style="margin-top: 10px;">' +
                            '<h4 style="margin-top: 0; color: #2c5282;">Census Tract</h4>';
            
            for (var key in props) {
                if (props.hasOwnProperty(key)) {
                    censusHTML += '<strong>' + key + ':</strong> ' + props[key] + '<br>';
                }
            }
            
            censusHTML += '</div>';
            featureInfo.innerHTML = censusHTML;
        }
    });
    
    // Change cursor on hover
    map.on('mousemove', function(e) {
        var bbox = [
            [e.point.x - 8, e.point.y - 8],
            [e.point.x + 8, e.point.y + 8]
        ];
        
        var features = map.queryRenderedFeatures(bbox, {
            layers: [STOPS_LAYER, ROUTES_LAYER, POLYGONS_LAYER]
        });
        
        map.getCanvas().style.cursor = features.length > 0 ? 'pointer' : '';
    });
});
</script>
