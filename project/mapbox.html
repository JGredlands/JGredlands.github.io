---
layout: default
title: Transit Map
permalink: project/mapbox/
---
<div> <h3><a href="/project"> <- Back to Dashboard </a></h3>
<div id="map" style="width: 100%; height: 600px;"></div>

<link href='https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js'></script>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiamdvYmF0MTMiLCJhIjoiY21nMnVtcTh6MTQ4bDJrb2puczF6dWoyeCJ9.6hqHyL74X4bJhjYJXvo9WQ';


const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/jgobat13/cmidr44cy007r01r985yx1icu',
    center: [-122.3328, 47.6061],
    zoom: 10
});

map.on('load', function() {
    const ROUTES_LAYER = 'TransitRoutes';
    const STOPS_LAYER = 'TransitStops';
    const POLYGONS_LAYER = 'CensusTracts';

    map.on('click', function(e) {
        const features = map.queryRenderedFeatures(e.point);
        console.log('=== CLICKED FEATURES ===');
        console.log('Number of features:', features.length);
        if (features.length > 0) {
            console.log('Top feature layer:', features[0].layer.id);
            console.log('All layers at click point:', features.map(f => f.layer.id));
        }
    });
    
    // TEST - Click on specific layers
    map.on('click', ROUTES_LAYER, function(e) {
        console.log('TransitRoutes clicked!');
        console.log('Properties:', e.features[0].properties);
        alert('Route clicked! Check console for properties.');
    });
    
    map.on('click', STOPS_LAYER, function(e) {
        console.log('TransitStops clicked!');
        console.log('Properties:', e.features[0].properties);
        alert('Stop clicked! Check console for properties.');
    });
    
    map.on('click', POLYGONS_LAYER, function(e) {
        console.log('CensusTracts clicked!');
        console.log('Properties:', e.features[0].properties);
        alert('Census tract clicked! Check console for properties.');
    });
});
    
    // TRANSIT ROUTES
    map.on('mousemove', ROUTES_LAYER, function(e) {
        map.getCanvas().style.cursor = 'pointer';
        
        const props = e.features[0].properties;
        
        const routeHTML = '<strong>Agency:</strong> ' + (props.agency_name || 'N/A') + '<br>' +
                          '<strong>Route:</strong> ' + (props.route_long_name || 'N/A') + '<br>' +
                          '<strong>Route Desc:</strong> ' + (props.route_desc || 'N/A') + '<br>' +
                          '<strong>Route Line:</strong> ' + (props.route_short_name || 'N/A') + '<br>' +
                          '<strong>URL:</strong> <a href="' + (props.route_url || '#') + '" target="_blank">More Info</a>';
        
        new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        })
            .setLngLat(e.lngLat)
            .setHTML(routeHTML)
            .addTo(map);
    });
    
    map.on('mouseleave', ROUTES_LAYER, function() {
        map.getCanvas().style.cursor = '';
        const popups = document.querySelectorAll('.mapboxgl-popup');
        popups.forEach(function(popup) {
            popup.remove();
        });
    });
    
    // TRANSIT STOPS
    map.on('mousemove', STOPS_LAYER, function(e) {
        map.getCanvas().style.cursor = 'pointer';
        
        const props = e.features[0].properties;
       
        
        const stopHTML = '<strong>Stop Name:</strong> ' + (props.stop_name || props.Stop_Name || 'N/A') + '<br>' 
                         
        
        new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        })
            .setLngLat(e.lngLat)
            .setHTML(stopHTML)
            .addTo(map);
    });
    
    map.on('mouseleave', STOPS_LAYER, function() {
        map.getCanvas().style.cursor = '';
        const popups = document.querySelectorAll('.mapboxgl-popup');
        popups.forEach(function(popup) {
            popup.remove();
        });
    });
    
    // DEMOGRAPHIC POLYGONS (Census Tracts)
    map.on('mousemove', POLYGONS_LAYER, function(e) {
        map.getCanvas().style.cursor = 'pointer';
        
        const props = e.features[0].properties;
        
  var censusHTML = '';
    for (var key in props) {
        if (props.hasOwnProperty(key)) {
            censusHTML += '<strong>' + key + ':</strong> ' + props[key] + '<br>';
        }
    }
        
        new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        })
            .setLngLat(e.lngLat)
            .setHTML(censusHTML)
            .addTo(map);
    });
    
    map.on('mouseleave', POLYGONS_LAYER, function() {
        map.getCanvas().style.cursor = '';
        const popups = document.querySelectorAll('.mapboxgl-popup');
        popups.forEach(function(popup) {
            popup.remove();
        });
    });
});
</script>
